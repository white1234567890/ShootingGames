#include "SceneManagerClass.h"

#include <gl\glew.h>
#include <gl\glut.h>

#include "common.h"

//////////////////////////////////////////////////////////////////////////////
//静的変数
//////////////////////////////////////////////////////////////////////////////

BaseSceneClass *SceneManagerClass::m_Scene;

//////////////////////////////////////////////////////////////////////////////
//実体化
//////////////////////////////////////////////////////////////////////////////
SceneManagerClass* cl_SceneManager;

SceneManagerClass::SceneManagerClass(void)
{
}


SceneManagerClass::~SceneManagerClass(void)
{
}

//////////////////////////////////////////////////////////////////////////////
//public関数
//////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////
//シーン遷移
//////////////////////////////////////////////////////////////////////////////
bool SceneManagerClass::ChangeScene(_SCENE scene)
{

	static SceneTitleClass SceneTitle;	//タイトルシーン
	static SceneMainClass SceneMain;	//メインシーン

	switch (scene)
	{
		//タイトルシーン
	case SceneManagerClass::E_GAME_TITLE:
		m_Scene = &SceneTitle;
		break;

		//メインシーン
	case SceneManagerClass::E_GAME_MAIN:
		m_Scene = &SceneMain;
		break;
	}

	//初期化
	if(!Initiarize()) return false;
	return true;
}

//////////////////////////////////////////////////////////////////////////////
//リシェイプ
//////////////////////////////////////////////////////////////////////////////
void SceneManagerClass::Reshape(int x , int y)
{
	WINDOW_WIDTH = x;	//ウィンドウ幅
	WINDOW_HEIGHT = y;	//ウィンドウ高さ

	m_Scene->Reshape();

	//ビューポート設定
	glViewport(0 , 0 , x , y);

	//変換行列の初期化
	glLoadIdentity();
}

//////////////////////////////////////////////////////////////////////////////
//初期化
//////////////////////////////////////////////////////////////////////////////
bool SceneManagerClass::Initiarize()
{
	if(!m_Scene->Initiarize()) return false;
	return true;
}

//////////////////////////////////////////////////////////////////////////////
//更新
//////////////////////////////////////////////////////////////////////////////
void SceneManagerClass::Update(int time)
{
	m_Scene->Update();
	
	//再描画
	glutPostRedisplay();

	//FPS60で更新
	glutTimerFunc(16 , Update , 0);
}

//////////////////////////////////////////////////////////////////////////////
//描画
//////////////////////////////////////////////////////////////////////////////
void SceneManagerClass::Render()
{
	m_Scene->Render();

	//再描画
	glutPostRedisplay();
}